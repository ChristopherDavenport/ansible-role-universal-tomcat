---
- hosts: localhost
  vars:
    test_user: tomcat
    tomcat_users:
      - name: "{{ test_user }}"
        password: "{{ test_user }}"
        roles: "manager-gui,admin-gui"
  pre_tasks:
    - name: Update apt cache.
      apt: update_cache=yes
      changed_when: False
      when: ansible_os_family == 'Debian'
  roles:
    - role_under_test
  post_tasks:
  - name: Wait For Service to Come Online
    pause:
      seconds: 10
  - name: Check Manager Application
    uri:
      url: http://0.0.0.0:8080/manager
      return_content: yes
      follow_redirects: all
      user: "{{ test_user }}"
      password: "{{ test_user }}"
    register: __tomcat_webpage
    when: tomcat_version != "6.0.47"
  - name: Debug Webpage
    debug: var=__tomcat_webpage
    when: tomcat_version != "6.0.47"
